/*
 * stockprices.java
 *
 * Created on November 5, 2002, 11:47 AM
 */

package com.afrisoftech.hospital;

/**
 *
 * @author  root
 */
public class NhifDebtsIntfr extends javax.swing.JInternalFrame {
    javax.swing.JComboBox cmbox2 =null;
    java.sql.Connection connectDB = null;
    
    org.netbeans.lib.sql.pool.PooledConnectionSource pConnDB = null;
    
    
    public NhifDebtsIntfr(java.sql.Connection connDb, org.netbeans.lib.sql.pool.PooledConnectionSource pconnDB) {
        
        connectDB = connDb;
        
        pConnDB = pconnDB;
        
        initComponents();
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        jSearchDialog21 = new javax.swing.JDialog();
        jSearchPanel21 = new javax.swing.JPanel();
        jTextField1131 = new javax.swing.JTextField();
        jSearchScrollPane21 = new javax.swing.JScrollPane();
        jSearchTable21 = new com.afrisoftech.dbadmin.JTable();
        jButton421 = new javax.swing.JButton();
        jButton521 = new javax.swing.JButton();
        jSearchDialog22 = new javax.swing.JDialog();
        jSearchPanel22 = new javax.swing.JPanel();
        jTextField1132 = new javax.swing.JTextField();
        jSearchScrollPane22 = new javax.swing.JScrollPane();
        jSearchTable22 = new com.afrisoftech.dbadmin.JTable();
        jButton422 = new javax.swing.JButton();
        jButton522 = new javax.swing.JButton();
        jLabel5 = new javax.swing.JLabel();
        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel11 = new javax.swing.JPanel();
        jPanel21 = new javax.swing.JPanel();
        jLabel11 = new javax.swing.JLabel();
        jLabel21 = new javax.swing.JLabel();
        jTextField11 = new javax.swing.JTextField();
        jLabel31 = new javax.swing.JLabel();
        jLabel41 = new javax.swing.JLabel();
        jTextField21 = new javax.swing.JTextField();
        jLabel71 = new javax.swing.JLabel();
        jTextField41 = new javax.swing.JTextField();
        jLabel81 = new javax.swing.JLabel();
        jTextField51 = new javax.swing.JTextField();
        jLabel91 = new javax.swing.JLabel();
        jTextField61 = new javax.swing.JTextField();
        jPanel41 = new javax.swing.JPanel();
        jTextField91 = new javax.swing.JTextField();
        searchButton1 = new javax.swing.JButton();
        jTextField71 = new javax.swing.JTextField();
        jLabel10 = new javax.swing.JLabel();
        jTextField8 = new javax.swing.JTextField();
        jLabel611 = new javax.swing.JLabel();
        jTextField311 = new javax.swing.JTextField();
        jLabel61 = new javax.swing.JLabel();
        jTextField31 = new javax.swing.JTextField();
        jCheckBox1 = new javax.swing.JCheckBox();
        jLabel1 = new javax.swing.JLabel();
        jTextField1 = new javax.swing.JTextField();
        jPanel42 = new javax.swing.JPanel();
        jTextField10 = new javax.swing.JTextField();
        searchButton2 = new javax.swing.JButton();
        jLabel12 = new javax.swing.JLabel();
        jTextField72 = new javax.swing.JTextField();
        jPanel3 = new javax.swing.JPanel();
        try  {
            java.lang.Class.forName("org.postgresql.Driver");
            System.out.println("Found driver");
        } catch(java.lang.ClassNotFoundException cnf){
            System.out.println("driver not found");
        }
        jButton11 = new javax.swing.JButton();
        jButton31 = new javax.swing.JButton();
        jButton41 = new javax.swing.JButton();
        jButton51 = new javax.swing.JButton();

        jSearchDialog21.getContentPane().setLayout(new java.awt.GridBagLayout());

        jSearchDialog21.setModal(true);
        jSearchDialog21.setUndecorated(true);
        jSearchPanel21.setLayout(new java.awt.GridBagLayout());

        jSearchPanel21.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jTextField1131.addCaretListener(new javax.swing.event.CaretListener() {
            public void caretUpdate(javax.swing.event.CaretEvent evt) {
                jTextField1131CaretUpdate(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 300.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 5);
        jSearchPanel21.add(jTextField1131, gridBagConstraints);

        jSearchTable21.setToolTipText("Click on the target row to select the patient from the search.");
        jSearchTable21.setShowHorizontalLines(false);
        /*javax.swing.table.TableColumn column = null;

        for (int i = 0; i < 4; i++) {

            column = jSearchTable2.getColumnModel().getColumn(i);

            if (i == 1) {

                column.setPreferredWidth(400);
                //sport column is bigger
            } else {

                column.setPreferredWidth(200);

            }
        }
        */
        jSearchTable21.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jSearchTable21MouseClicked(evt);
            }
        });

        jSearchScrollPane21.setViewportView(jSearchTable21);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 20.0;
        jSearchPanel21.add(jSearchScrollPane21, gridBagConstraints);

        jButton421.setText("Select");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jSearchPanel21.add(jButton421, gridBagConstraints);

        jButton521.setText("Close");
        jButton521.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton521ActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jSearchPanel21.add(jButton521, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jSearchDialog21.getContentPane().add(jSearchPanel21, gridBagConstraints);

        jSearchDialog22.getContentPane().setLayout(new java.awt.GridBagLayout());

        jSearchDialog22.setModal(true);
        jSearchDialog22.setUndecorated(true);
        jSearchPanel22.setLayout(new java.awt.GridBagLayout());

        jSearchPanel22.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jTextField1132.addCaretListener(new javax.swing.event.CaretListener() {
            public void caretUpdate(javax.swing.event.CaretEvent evt) {
                jTextField1132CaretUpdate(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 300.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 5);
        jSearchPanel22.add(jTextField1132, gridBagConstraints);

        jSearchTable22.setToolTipText("Click on the target row to select the patient from the search.");
        jSearchTable22.setShowHorizontalLines(false);
        /*javax.swing.table.TableColumn column = null;

        for (int i = 0; i < 4; i++) {

            column = jSearchTable2.getColumnModel().getColumn(i);

            if (i == 1) {

                column.setPreferredWidth(400);
                //sport column is bigger
            } else {

                column.setPreferredWidth(200);

            }
        }
        */
        jSearchTable22.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jSearchTable22MouseClicked(evt);
            }
        });

        jSearchScrollPane22.setViewportView(jSearchTable22);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 20.0;
        jSearchPanel22.add(jSearchScrollPane22, gridBagConstraints);

        jButton422.setText("Select");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jSearchPanel22.add(jButton422, gridBagConstraints);

        jButton522.setText("Close");
        jButton522.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton522ActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jSearchPanel22.add(jButton522, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jSearchDialog22.getContentPane().add(jSearchPanel22, gridBagConstraints);

        getContentPane().setLayout(new java.awt.GridBagLayout());

        setClosable(true);
        setIconifiable(true);
        setMaximizable(true);
        setResizable(true);
        setTitle("NHIF Credits");
        setPreferredSize(new java.awt.Dimension(650, 700));
        setVisible(true);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        getContentPane().add(jLabel5, gridBagConstraints);

        jPanel11.setLayout(new java.awt.GridBagLayout());

        jPanel11.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 0, 0), 1, true));
        jPanel21.setLayout(new java.awt.GridBagLayout());

        jLabel11.setText("Reference");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 30, 0, 0);
        jPanel21.add(jLabel11, gridBagConstraints);

        jLabel21.setText("Ward Name");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 30, 0, 0);
        jPanel21.add(jLabel21, gridBagConstraints);

        jTextField11.setEditable(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel21.add(jTextField11, gridBagConstraints);

        jLabel31.setText("Patient No.");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 30, 0, 0);
        jPanel21.add(jLabel31, gridBagConstraints);

        jLabel41.setText("Patient Name");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 30, 0, 0);
        jPanel21.add(jLabel41, gridBagConstraints);

        jTextField21.setEditable(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel21.add(jTextField21, gridBagConstraints);

        jLabel71.setText("Card No.");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 30, 0, 0);
        jPanel21.add(jLabel71, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 4;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 10);
        jPanel21.add(jTextField41, gridBagConstraints);

        jLabel81.setText("Discharge Date");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 30, 0, 0);
        jPanel21.add(jLabel81, gridBagConstraints);

        jTextField51.setEditable(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 4;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 10);
        jPanel21.add(jTextField51, gridBagConstraints);

        jLabel91.setText("Admission Date");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 30, 0, 0);
        jPanel21.add(jLabel91, gridBagConstraints);

        jTextField61.setEditable(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 4;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 10);
        jPanel21.add(jTextField61, gridBagConstraints);

        jPanel41.setLayout(new java.awt.GridBagLayout());

        jPanel41.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jTextField91.setEditable(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel41.add(jTextField91, gridBagConstraints);

        searchButton1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/kiwi/images/date.gif")));
        searchButton1.setToolTipText("Search");
        searchButton1.setHorizontalAlignment(javax.swing.SwingConstants.TRAILING);
        searchButton1.setMaximumSize(new java.awt.Dimension(74, 53));
        searchButton1.setMinimumSize(new java.awt.Dimension(74, 53));
        searchButton1.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        searchButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                searchButton1ActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 2;
        jPanel41.add(searchButton1, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel21.add(jPanel41, gridBagConstraints);

        jTextField71.setEditable(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 4;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 10);
        jPanel21.add(jTextField71, gridBagConstraints);

        jLabel10.setText("Bed No.");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 30, 0, 0);
        jPanel21.add(jLabel10, gridBagConstraints);

        jTextField8.setEditable(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel21.add(jTextField8, gridBagConstraints);

        jLabel611.setFont(new java.awt.Font("SansSerif", 1, 14));
        jLabel611.setText("Total Bill");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 30, 0, 0);
        jPanel21.add(jLabel611, gridBagConstraints);

        jTextField311.setEditable(false);
        jTextField311.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        jTextField311.setText("0.00");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel21.add(jTextField311, gridBagConstraints);

        jLabel61.setFont(new java.awt.Font("SansSerif", 1, 14));
        jLabel61.setText("NHIF To Pay");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 30, 0, 0);
        jPanel21.add(jLabel61, gridBagConstraints);

        jTextField31.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 4;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 10);
        jPanel21.add(jTextField31, gridBagConstraints);

        jCheckBox1.setText("Invoice No.");
        jCheckBox1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBox1ActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 30, 0, 0);
        jPanel21.add(jCheckBox1, gridBagConstraints);

        jLabel1.setText("Visit Id");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 30, 0, 0);
        jPanel21.add(jLabel1, gridBagConstraints);

        jTextField1.setEditable(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        jPanel21.add(jTextField1, gridBagConstraints);

        jPanel42.setLayout(new java.awt.GridBagLayout());

        jPanel42.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jTextField10.setEditable(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel42.add(jTextField10, gridBagConstraints);

        searchButton2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/kiwi/images/date.gif")));
        searchButton2.setToolTipText("Search");
        searchButton2.setEnabled(false);
        searchButton2.setHorizontalAlignment(javax.swing.SwingConstants.TRAILING);
        searchButton2.setMaximumSize(new java.awt.Dimension(74, 53));
        searchButton2.setMinimumSize(new java.awt.Dimension(74, 53));
        searchButton2.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        searchButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                searchButton2ActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 2;
        jPanel42.add(searchButton2, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 4;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel21.add(jPanel42, gridBagConstraints);

        jLabel12.setText("No. of days");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 30, 0, 0);
        jPanel21.add(jLabel12, gridBagConstraints);

        jTextField72.setEditable(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 4;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 10);
        jPanel21.add(jTextField72, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridwidth = 6;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 5.0;
        jPanel11.add(jPanel21, gridBagConstraints);

        jPanel3.setLayout(new java.awt.GridBagLayout());

        jPanel3.setBorder(javax.swing.BorderFactory.createTitledBorder(""));
        jButton11.setMnemonic('S');
        jButton11.setText("Save");
        jButton11.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton11ActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel3.add(jButton11, gridBagConstraints);

        jButton31.setMnemonic('R');
        jButton31.setText("Refresh");
        jButton31.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton31ActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel3.add(jButton31, gridBagConstraints);

        jButton41.setMnemonic('C');
        jButton41.setText("Close");
        jButton41.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton41ActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 4;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel3.add(jButton41, gridBagConstraints);

        jButton51.setMnemonic('h');
        jButton51.setText("Help");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 6;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel3.add(jButton51, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 6;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        jPanel11.add(jPanel3, gridBagConstraints);

        jTabbedPane1.addTab("Inpatients", jPanel11);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        getContentPane().add(jTabbedPane1, gridBagConstraints);

        setBounds(0, 0, 700, 482);
    }// </editor-fold>//GEN-END:initComponents
    
    private void jButton522ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton522ActionPerformed
        jSearchDialog22.dispose();  // TODO add your handling code here:
    }//GEN-LAST:event_jButton522ActionPerformed
    
    private void jSearchTable22MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jSearchTable22MouseClicked
        
        jTextField10.setText(jSearchTable22.getValueAt(jSearchTable22.getSelectedRow(), 0).toString());
/* try {
 
                    java.sql.Statement pss12q = connectDB.createStatement();
                    java.sql.ResultSet rsts11q = pss12q.executeQuery("select reference_no from ac_debtors where invoice_no  = '"+jTextField10.getText().toString()+"'");
                    while (rsts11q.next()){
                        jTextField72.setText(rsts11q.getString((1));
 
                    }
           }catch(java.sql.SQLException sq){
 
 
                    System.out.println(sq.getMessage());
                    javax.swing.JOptionPane.showMessageDialog(this,sq.getMessage(), "Error",javax.swing.JOptionPane.ERROR_MESSAGE);
                }
 */
        // jTextField72.setText(jSearchTable22.getValueAt(jSearchTable22.getSelectedRow(), 1).toString());
        
        //  jSearchDialog22.dispose();
        this.jSearchDialog22.dispose();
// TODO add your handling code here:
    }//GEN-LAST:event_jSearchTable22MouseClicked
    
    private void jTextField1132CaretUpdate(javax.swing.event.CaretEvent evt) {//GEN-FIRST:event_jTextField1132CaretUpdate
        jSearchTable22.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB,"select distinct(invoice_no) as invoice_no from hp_admission where invoice_no ILIKE '"+jTextField1132.getText()+"%' AND discharge = true and discharge_date::date ='"+jTextField61.getText()+"' AND PATIENT_NO ='"+jTextField91.getText()+"' order by invoice_no"));
//   jSearchTable22.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB,"select distinct(invoice_no) as invoice_no, reference from final_invoices where invoice_no ILIKE '"+jTextField1132.getText()+"%' and date::date ='"+jTextField61.getText()+"' AND PATIENT_NO ='"+jTextField91.getText()+"' order by invoice_no"));
        // jSearchTable22.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB,"select distinct(invoice_no) as invoice_no, reference from final_invoices where invoice_no ILIKE '"+jTextField1132.getText()+"%' AND PATIENT_NO ='"+jTextField91.getText()+"' order by invoice_no"));
        
      /*
       
        try {
             searchRowSet21.execute("select distinct(patient_no) as pat_no,patient_name as name,visit_id,date_admitted from hp_admission where patient_no ILIKE '"+jTextField1131.getText()+"%' AND discharge = true order by patient_no,date_admitted");
       
            jSearchTable21.setModel(new org.netbeans.lib.sql.models.TableModel(searchRowSet21, new org.netbeans.lib.sql.models.TableModel.Column[] {
                new org.netbeans.lib.sql.models.TableModel.Column("pat_no", "Patient No", false),
                new org.netbeans.lib.sql.models.TableModel.Column("name", "Name", false),
                new org.netbeans.lib.sql.models.TableModel.Column("visit_id", "Visit ID.", false),
                new org.netbeans.lib.sql.models.TableModel.Column("date_admitted", "Date Admitted", false)
       
            }));
       */
        jSearchScrollPane22.setViewportView(jSearchTable22);
        System.out.println("Cannot sort out");
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField1132CaretUpdate
    
    private void searchButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_searchButton2ActionPerformed
        this.searchButton2.setEnabled(false);
        searchButton22Clicked();// TODO add your handling code here:
    }//GEN-LAST:event_searchButton2ActionPerformed
    
    private void jCheckBox1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBox1ActionPerformed
        if(jCheckBox1.isSelected()){
            this.searchButton2.setEnabled(true);
        }else {
            this.searchButton2.setEnabled(false);
            // Add your handling code here:
        }
    }//GEN-LAST:event_jCheckBox1ActionPerformed
    
    private void jButton31ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton31ActionPerformed
        this.getContentPane().removeAll();
        this.initComponents();
    }//GEN-LAST:event_jButton31ActionPerformed
    
    private void jButton41ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton41ActionPerformed
        this.setVisible(false);        // Add your handling code here:
    }//GEN-LAST:event_jButton41ActionPerformed
    
    private void jButton11ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton11ActionPerformed
        int claims = 0;
        if(jTextField10.getText().toString().equalsIgnoreCase("")){
            javax.swing.JOptionPane.showMessageDialog(this,"You must select Invoice No.", "Error",javax.swing.JOptionPane.ERROR_MESSAGE);
            
        }else{
            
            
            
            double nhif = java.lang.Double.parseDouble(jTextField31.getText());
            double bill = java.lang.Double.parseDouble(jTextField311.getText());
            
            java.util.Calendar calendar = java.util.Calendar.getInstance();
            
            long dateNow = calendar.getTimeInMillis();
            
            java.sql.Date datenowSql1= new java.sql.Date(dateNow);
            
            System.out.println(datenowSql1.toString());
            
            java.sql.Timestamp datenowSql= new java.sql.Timestamp(dateNow);
            
            System.out.println(datenowSql.toString());
            
            String receiptNo = null;
            String actCode = null;
            String glCode = null;
            String bankAcc = null;
            String glCode1 = null;
            String bankAcc1 = null;
            String transNo = null;
            String payMode = null;
            String patCat = null;
            String patientAcc = null;
            String cardNo = null;
            String scheme = null;
            String cardName = null;
            String isurer = null;
            String expDate = null;
            String staffNo = null;
            String actNames = null;
            String user = null;
            String actNames1 = null;
            String actCode1 = null;
            String invoiceNo = null;
            String Account = null;
            String Payer = null;
            
            String InvDate = null;
           
            invoiceNo = this.jTextField91.getText();
            
            if (bill >= 0){
                int exitOption = javax.swing.JOptionPane.showConfirmDialog(this, "Confirm NHIF Card No. !!", "Caution before Saving!", javax.swing.JOptionPane.YES_NO_CANCEL_OPTION);
                
                if (exitOption == javax.swing.JOptionPane.YES_OPTION) {
                    
                    
                    try {
                        
                        
                        
                        
                java.sql.Statement ps1q = connectDB.createStatement();
            java.sql.ResultSet rst1q = ps1q.executeQuery("select count(service) from hp_patient_card where service ilike 'n.h.i.%' AND invoice_no = '"+jTextField10.getText()+"'");
            while (rst1q.next()){
                
                claims = rst1q.getInt(1);
                
            }
            
            if ( claims > 0){
                javax.swing.JOptionPane.showMessageDialog(this, "Nhif has been deducted from this Bill", "Information Message!", javax.swing.JOptionPane.YES_OPTION);
           
            }else{
            
                        
                        connectDB.setAutoCommit(false);
                        
                        java.sql.Statement pss12q = connectDB.createStatement();
                        java.sql.ResultSet rsts11q = pss12q.executeQuery("select date from ac_debtors where invoice_no  = '"+invoiceNo+"'");
                        while (rsts11q.next()){
                            InvDate = rsts11q.getObject(1).toString();
                            
                        }
                        java.sql.Statement stm1 = connectDB.createStatement();
                        
                        java.sql.ResultSet rse1 = stm1.executeQuery("select pay_mode,account_no,description,expiry_date,payer,category from hp_inpatient_register where patient_no ='"+jTextField91.getText()+"'");
                        while (rse1.next()){
                            
                            payMode = rse1.getObject(1).toString();
                            patCat = rse1.getObject(6).toString();
                        }
                        java.sql.Statement pss = connectDB.createStatement();
                        java.sql.ResultSet rss = pss.executeQuery("select nextval('transaction_no_seq')");
                        while (rss.next()){
                            transNo = rss.getObject(1).toString();
                        }
                        java.sql.Statement pss1 = connectDB.createStatement();
                        java.sql.ResultSet rss1 = pss1.executeQuery("select lpad(nextval('claim_no_seq'),5,0)");
                        while (rss1.next()){
                            invoiceNo = rss1.getObject(1).toString();
                        }
                        java.sql.Statement pss12 = connectDB.createStatement();
                        java.sql.ResultSet rsts11 = pss12.executeQuery("select code,activity from pb_activity where activity_category ='PR'");
                        while (rsts11.next()){
                            actCode = rsts11.getObject(1).toString();
                            actNames = rsts11.getObject(2).toString();
                        }
                        java.sql.Statement pss121 = connectDB.createStatement();
                        java.sql.ResultSet rsts111 = pss121.executeQuery("select account_no,payer_name from ac_schemes where category ILIKE 'N H I F%'");
                        while (rsts111.next()){
                            Account = rsts111.getObject(1).toString();
                            Payer = rsts111.getObject(2).toString();
                        }
                        java.sql.Statement pss11 = connectDB.createStatement();
                        java.sql.ResultSet rsts1 = pss11.executeQuery("select code,activity,current_user from pb_activity where activity_category ='DA'");
                        while (rsts1.next()){
                            actCode1 = rsts1.getObject(1).toString();
                            actNames1 = rsts1.getObject(2).toString();
                            user = rsts1.getObject(3).toString();
                        }
                        java.sql.PreparedStatement pstmt = connectDB.prepareStatement("insert into hp_patient_card values(?,?,?,?,?,?,?,?,?,?,?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,?,?,?,?,?,?,?)");
                        pstmt.setString(1,jTextField91.getText());
                        pstmt.setObject(2,"N.H.I.F");
                        pstmt.setString(3,patCat);
                        pstmt.setString(4,payMode);
                        pstmt.setString(5,invoiceNo);
                        pstmt.setString(7,"N.H.I.F");
                        pstmt.setString(6,jTextField41.getText());
                        pstmt.setString(8,"N.H.I.F");
                        pstmt.setString(9,"N.H.I.F");
                        pstmt.setDate(10,null);
                        pstmt.setString(11,"");
                        if (bill > nhif){
                            pstmt.setDouble(13,java.lang.Double.valueOf(jTextField31.getText()));
                            
                        }else{
                            if (bill == 0.00){
                                pstmt.setDouble(13,java.lang.Double.valueOf(jTextField31.getText()));
                                
                                
                            }else{
                                // pstmt.setDouble(13,java.lang.Double.valueOf(jTextField311.getText()));
                                pstmt.setDouble(13,java.lang.Double.valueOf(jTextField31.getText()));
                                
                            }
                        }
                        pstmt.setDouble(12,0.00);
                        pstmt.setDate(14,com.afrisoftech.lib.SQLDateFormat.getSQLDate(java.sql.Date.valueOf(jTextField61.getText())));
                        pstmt.setObject(15,actCode);
                        pstmt.setString(16,"N.H.I.F");
                        pstmt.setDouble(17,1);
                        pstmt.setObject(18,jTextField41.getText());
                        if(this.jCheckBox1.isSelected()){
                            pstmt.setBoolean(19,true);
                            pstmt.setString(23,jTextField10.getText().toUpperCase());
                        }else{
                            javax.swing.JOptionPane.showMessageDialog(this,"You must select which Patient Invoice_no to effect the Rebate!","Error Message!",javax.swing.JOptionPane.INFORMATION_MESSAGE);
                            
                            pstmt.setBoolean(19,false);
                            pstmt.setString(23,invoiceNo);
                        }
                        pstmt.setString(20,"Remittance");
                        pstmt.setBoolean(21,false);
                        pstmt.setString(22,actNames);
                        pstmt.setString(24,user);
                        pstmt.setString(25,"-");
                        pstmt.setString(26,"IP");
                        pstmt.setTimestamp(27,new java.sql.Timestamp(java.util.Calendar.getInstance().getTimeInMillis()));
                        pstmt.setObject(28,jTextField1.getText());
                        pstmt.executeUpdate();
                        
                        
                        java.sql.PreparedStatement pstmt1 = connectDB.prepareStatement("insert into ac_debtors values(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,?,?,?,?,?,?,?)");
                        pstmt1.setObject(1,actCode1);
                        pstmt1.setString(4,jTextField91.getText());
                        pstmt1.setObject(3,jTextField11.getText());
                        pstmt1.setString(5,"N H I F");
                        pstmt1.setString(2,Payer);
                        pstmt1.setString(6,"");
                        pstmt1.setString(7,Account);
                        pstmt1.setString(8,"");
                        pstmt1.setString(9,"");
                        pstmt1.setString(10,jTextField41.getText());
                        pstmt1.setString(11,invoiceNo);
                        pstmt1.setString(12,"Invoice");
                        if (bill > nhif){
                            pstmt1.setDouble(13,java.lang.Double.valueOf(jTextField31.getText()));
                            
                        }else{
                            if (bill == 0.00){
                                pstmt1.setDouble(13,java.lang.Double.valueOf(jTextField31.getText()));
                                
                            }else{
                                //  pstmt1.setDouble(13,java.lang.Double.valueOf(jTextField311.getText()));
                                pstmt1.setDouble(13,java.lang.Double.valueOf(jTextField31.getText()));
                            }
                        }
                        // pstmt1.setString(13,jTextField31.getText());
                        pstmt1.setDouble(14,0.00);
                        pstmt1.setDate(15,com.afrisoftech.lib.SQLDateFormat.getSQLDate(java.sql.Date.valueOf(jTextField61.getText())));
                        pstmt1.setObject(16,invoiceNo);
                        pstmt1.setString(17,actNames1);
                        pstmt1.setBoolean(18,false);
                        pstmt1.setBoolean(19,false);
                        pstmt1.setString(20,user);
                        pstmt1.setString(21,"");
                        if (bill > nhif){
                            pstmt1.setDouble(22,java.lang.Double.valueOf(jTextField31.getText()));
                            
                        }else{
                            if (bill == 0.00){
                                pstmt1.setDouble(22,java.lang.Double.valueOf(jTextField31.getText()));
                                
                            }else{
                                //pstmt1.setDouble(22,java.lang.Double.valueOf(jTextField311.getText()));
                                pstmt1.setDouble(22,java.lang.Double.valueOf(jTextField31.getText()));
                            }
                        }
                        pstmt1.setBoolean(23,false);
                        pstmt1.setDouble(24,0.00);
                        
                        pstmt1.executeUpdate();
                        
                        
                        java.sql.PreparedStatement pstmt1fa = connectDB.prepareStatement("insert into final_invoices values(?,?,?,?,?,?,?,?,?,?)");
                        pstmt1fa.setString(1,invoiceNo);
                        pstmt1fa.setObject(2,Account);
                        pstmt1fa.setString(3,"N H I F");
                        pstmt1fa.setString(4,Payer);
                        if (bill > nhif){
                            pstmt1fa.setDouble(5,java.lang.Double.valueOf(jTextField31.getText()));
                            
                        }else{
                            if (bill == 0.00){
                                pstmt1fa.setDouble(5,java.lang.Double.valueOf(jTextField31.getText()));
                                
                            }else{
                                //  pstmt1.setDouble(13,java.lang.Double.valueOf(jTextField311.getText()));
                                pstmt1fa.setDouble(5,java.lang.Double.valueOf(jTextField31.getText()));
                            }
                        }
                        
                        pstmt1fa.setDate(6,com.afrisoftech.lib.SQLDateFormat.getSQLDate(java.sql.Date.valueOf(jTextField61.getText())));
                        pstmt1fa.setString(8,jTextField91.getText());
                        pstmt1fa.setString(7,invoiceNo);
                        pstmt1fa.setString(9,jTextField11.getText());
                        pstmt1fa.setString(10,user);
                        pstmt1fa.executeUpdate();
                        
                        java.sql.PreparedStatement pstm = connectDB.prepareStatement("update ac_debtors set debit  = debit - "+nhif+",balance = balance - "+nhif+" where invoice_no ilike '"+jTextField10.getText()+"'");
                        pstm.executeUpdate();
                        
                        
                        java.sql.PreparedStatement pstmz = connectDB.prepareStatement("update hp_patient_card set credit  = credit - "+nhif+" where INVOICE_NO ilike '"+jTextField10.getText()+"' and service = 'Invoice' and credit >0 ");
                        pstmz.executeUpdate();
                        
                  /*
                    if(this.jCheckBox1.isSelected()){
                   
                        java.sql.PreparedStatement pstmt21 = connectDB.prepareStatement("insert into ac_ledger values(?,?,?,?,?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,?,?,?)");
                        pstmt21.setObject(1,actCode);
                        pstmt21.setObject(2,actNames);
                        pstmt21.setString(3,jTextField91.getText());
                        pstmt21.setString(4,jTextField11.getText());
                        pstmt21.setString(5,"");
                        pstmt21.setString(6,"");
                        pstmt21.setString(7,"");
                        pstmt21.setString(8,"IP");
                        pstmt21.setString(9,"");
                        pstmt21.setString(10,"");
                        pstmt21.setString(11,"");
                        pstmt21.setString(12,"");
                        pstmt21.setString(13,"");
                        pstmt21.setString(14,"Invoice Adjustment");
                        pstmt21.setString(15,"Amend Invoice");
                        pstmt21.setDouble(17,0.00);
                        pstmt21.setDouble(16,java.lang.Double.valueOf(jTextField31.getText()));
                        pstmt21.setDate(18,com.afrisoftech.lib.SQLDateFormat.getSQLDate(java.sql.Date.valueOf(jTextField61.getText())));
                        pstmt21.setString(19,transNo);
                        pstmt21.setBoolean(20,false);
                        pstmt21.setBoolean(21,false);
                        pstmt21.setBoolean(22,false);
                        pstmt21.setString(23,user);
                        pstmt21.executeUpdate();
                   
                        java.sql.PreparedStatement pstm = connectDB.prepareStatement("update ac_debtors set debit  = debit - "+nhif+",balance = balance - "+nhif+" where invoice_no ilike '"+jTextField10.getText()+"'");
                        pstm.executeUpdate();
                   
                    }
                   **/
                        connectDB.commit();
                        connectDB.setAutoCommit(true);
                        
                        javax.swing.JOptionPane.showMessageDialog(this,"Data Inserted Successfully \n Claim No. is: "+invoiceNo+"","Confirmation Message!",javax.swing.JOptionPane.INFORMATION_MESSAGE);
                        
                        jTextField11.setText("");
                        jTextField21.setText("");
                        jTextField10.setText("");
                        jCheckBox1.setSelected(false);
                        searchButton2.setEnabled(false);
                        jTextField31.setText("0.00");
                        //            jComboBox1.setSelectedItem(null);
                        //  jComboBox2.setSelectedItem(null);
                    }
                    }catch(java.sql.SQLException sq){
                        
                        try {
                            connectDB.rollback();
                        }catch (java.sql.SQLException sql){
                            javax.swing.JOptionPane.showMessageDialog(this,sql.getMessage(),"Error Message!",javax.swing.JOptionPane.ERROR_MESSAGE);
                        }
                        System.out.println(sq.getMessage());
                        javax.swing.JOptionPane.showMessageDialog(this,sq.getMessage(), "Error",javax.swing.JOptionPane.ERROR_MESSAGE);
                    }
                }
            }else
                if (bill <0){
                int exitOption = javax.swing.JOptionPane.showConfirmDialog(this, "Confirm NHIF Card No. !!", "Caution before Saving!", javax.swing.JOptionPane.YES_NO_CANCEL_OPTION);
                
                if (exitOption == javax.swing.JOptionPane.YES_OPTION) {
                    try {
                        connectDB.setAutoCommit(false);
                        
                        java.sql.Statement stm1 = connectDB.createStatement();
                        
                        java.sql.ResultSet rse1 = stm1.executeQuery("select pay_mode,account_no,description,expiry_date,payer,category from hp_inpatient_register where patient_no ='"+jTextField91.getText()+"'");
                        while (rse1.next()){
                            
                            payMode = rse1.getObject(1).toString();
                            patCat = rse1.getObject(6).toString();
                        }
                        java.sql.Statement pss = connectDB.createStatement();
                        java.sql.ResultSet rss = pss.executeQuery("select nextval('transaction_no_seq')");
                        while (rss.next()){
                            transNo = rss.getObject(1).toString();
                        }
                        java.sql.Statement pss1 = connectDB.createStatement();
                        java.sql.ResultSet rss1 = pss1.executeQuery("select lpad(nextval('claim_no_seq'),5,0)");
                        while (rss1.next()){
                            invoiceNo = rss1.getObject(1).toString();
                        }
                        java.sql.Statement pss12 = connectDB.createStatement();
                        java.sql.ResultSet rsts11 = pss12.executeQuery("select code,activity from pb_activity where activity_category ='PR'");
                        while (rsts11.next()){
                            actCode = rsts11.getObject(1).toString();
                            actNames = rsts11.getObject(2).toString();
                        }
                        java.sql.Statement pss121 = connectDB.createStatement();
                        java.sql.ResultSet rsts111 = pss121.executeQuery("select account_no,payer_name from ac_schemes where category ILIKE 'N H I F%'");
                        while (rsts111.next()){
                            Account = rsts111.getObject(1).toString();
                            Payer = rsts111.getObject(2).toString();
                        }
                        java.sql.Statement pss11 = connectDB.createStatement();
                        java.sql.ResultSet rsts1 = pss11.executeQuery("select code,activity,current_user from pb_activity where activity_category ='DA'");
                        while (rsts1.next()){
                            actCode1 = rsts1.getObject(1).toString();
                            actNames1 = rsts1.getObject(2).toString();
                            user = rsts1.getObject(3).toString();
                        }
                        java.sql.PreparedStatement pstmt = connectDB.prepareStatement("insert into hp_patient_card values(?,?,?,?,?,?,?,?,?,?,?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,?,?,?,?,?,?,?)");
                        pstmt.setString(1,jTextField91.getText());
                        pstmt.setObject(2,"N.H.I.F");
                        pstmt.setString(3,patCat);
                        pstmt.setString(4,payMode);
                        pstmt.setString(5,invoiceNo);
                        pstmt.setString(7,"N.H.I.F");
                        pstmt.setString(6,jTextField41.getText());
                        pstmt.setString(8,"N.H.I.F");
                        pstmt.setString(9,"N.H.I.F");
                        pstmt.setDate(10,null);
                        pstmt.setString(11,"");
                        pstmt.setDouble(13,java.lang.Double.valueOf(jTextField31.getText()));
                        pstmt.setDouble(12,0.00);
                        pstmt.setDate(14,com.afrisoftech.lib.SQLDateFormat.getSQLDate(java.sql.Date.valueOf(jTextField61.getText())));
                        pstmt.setObject(15,actCode);
                        pstmt.setString(16,"N.H.I.F");
                        pstmt.setDouble(17,1);
                        pstmt.setObject(18,jTextField41.getText());
                        pstmt.setBoolean(19,false);
                        pstmt.setString(20,"Remittance");
                        pstmt.setBoolean(21,false);
                        pstmt.setString(22,actNames);
                        pstmt.setString(23,invoiceNo);
                        pstmt.setString(24,user);
                        pstmt.setString(25,"-");
                        pstmt.setString(26,"IP");
                        pstmt.setTimestamp(27,new java.sql.Timestamp(java.util.Calendar.getInstance().getTimeInMillis()));
                        pstmt.setObject(28,jTextField1.getText());
                        
                        pstmt.executeUpdate();
                        
                        
                        java.sql.PreparedStatement pstmt1 = connectDB.prepareStatement("insert into ac_debtors values(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,?,?,?,?,?,?,?)");
                        pstmt1.setObject(1,actCode1);
                        pstmt1.setString(4,jTextField91.getText());
                        pstmt1.setObject(3,jTextField11.getText());
                        pstmt1.setString(5,"N H I F");
                        pstmt1.setString(2,Payer);
                        pstmt1.setString(6,"");
                        pstmt1.setString(7,Account);
                        pstmt1.setString(8,"");
                        pstmt1.setString(9,"");
                        pstmt1.setString(10,jTextField41.getText());
                        pstmt1.setString(11,invoiceNo);
                        pstmt1.setString(12,"Raise Invoice");
                        pstmt1.setDouble(13,java.lang.Double.valueOf(jTextField31.getText()));
                        pstmt1.setDouble(14,0.00);
                        pstmt1.setDate(15,com.afrisoftech.lib.SQLDateFormat.getSQLDate(java.sql.Date.valueOf(jTextField61.getText())));
                        pstmt1.setObject(16,invoiceNo);
                        pstmt1.setString(17,actNames1);
                        pstmt1.setBoolean(18,false);
                        pstmt1.setBoolean(19,false);
                        pstmt1.setString(20,user);
                        pstmt1.setString(21,"");
                        pstmt1.setDouble(22,java.lang.Double.valueOf(jTextField31.getText()));
                        pstmt1.setBoolean(23,false);
                        pstmt1.setDouble(24,0.00);
                        pstmt1.executeUpdate();
                        
                        //  java.sql.PreparedStatement pstm = connectDB.prepareStatement("update hp_patient_card set invoice_no ='"+invoiceNo+"' where date BETWEEN '"+jTextField51.getText()+"' AND '"+jTextField61.getText()+"' AND patient_no = '"+jTextField91.getText()+"'");
                        //  pstm.executeUpdate();
                        
                        connectDB.commit();
                        connectDB.setAutoCommit(true);
                        
                        javax.swing.JOptionPane.showMessageDialog(this,"Data Inserted Successfully \n Claim No. is: "+invoiceNo+"","Confirmation Message!",javax.swing.JOptionPane.INFORMATION_MESSAGE);
                        
                        jTextField11.setText("");
                        jTextField21.setText("");
                        jTextField31.setText("");
                        
                        jTextField31.setText("0.00");
                        
                    }catch(java.sql.SQLException sq){
                        
                        try {
                            connectDB.rollback();
                        }catch (java.sql.SQLException sql){
                            javax.swing.JOptionPane.showMessageDialog(this,sql.getMessage(),"Error Message!",javax.swing.JOptionPane.ERROR_MESSAGE);
                        }
                        System.out.println(sq.getMessage());
                        javax.swing.JOptionPane.showMessageDialog(this,sq.getMessage(), "Error",javax.swing.JOptionPane.ERROR_MESSAGE);
                    }
                }
                }
        }
        // Add your handling code here:
    }//GEN-LAST:event_jButton11ActionPerformed
    
    private void searchButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_searchButton1ActionPerformed
        this.searchButton2.setEnabled(false);
        searchButton21Clicked(); // Add your handling code here:
    }//GEN-LAST:event_searchButton1ActionPerformed
    
    private void jButton521ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton521ActionPerformed
        jSearchDialog21.dispose();      // Add your handling code here:
    }//GEN-LAST:event_jButton521ActionPerformed
    
    private void jSearchTable21MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jSearchTable21MouseClicked
        float Rate = 00;
        
        jTextField11.setText(jSearchTable21.getValueAt(jSearchTable21.getSelectedRow(), 1).toString());
        jTextField91.setText(jSearchTable21.getValueAt(jSearchTable21.getSelectedRow(), 0).toString());
        jTextField51.setText(jSearchTable21.getValueAt(jSearchTable21.getSelectedRow(), 3).toString());
        jTextField1.setText(jSearchTable21.getValueAt(jSearchTable21.getSelectedRow(), 2).toString());
        //jTextField71.setText(jSearchTable21.getValueAt(jSearchTable21.getSelectedRow(), 3).toString());
        
        
        
        try {
            //select trim(patient_no) as pat_no,patient_name as name from hp_admission where patient_name ILIKE '"+jTextField1131.getText()+"%' AND mode_of_payment = 'Scheme' and discharge = true order by patient_name");
            java.sql.Statement stmt = connectDB.createStatement();
            java.sql.ResultSet rset = stmt.executeQuery("select discharge_date::date from hp_admission where visit_id ='"+jTextField1.getText()+"'");
            while (rset.next()){
                // jComboBox6.setSelectedItem(rset.getObject(1).toString());
                jTextField61.setText(rset.getObject(1).toString());
                //jTextField1.setText(rset.getObject(2).toString());
                //jTextField4.setText(rset.getObject(3).toString());
                
                
            }
            java.sql.Statement stmt11 = connectDB.createStatement();
            java.sql.ResultSet rset11 = stmt11.executeQuery("select ad.discharge_date::date -  ad.date_admitted::date from hp_admission ad where ad.patient_no = '"+jTextField91.getText()+"' and ad.visit_id = '"+jTextField1.getText()+"'");
            while (rset11.next()){
                // jComboBox6.setSelectedItem(rset.getObject(1).toString());
                jTextField71.setText(rset11.getObject(1).toString());
                //jTextField1.setText(rset.getObject(2).toString());
                //jTextField4.setText(rset.getObject(3).toString());
                
                
            }
            
        } catch (java.sql.SQLException sqe) {
            sqe.printStackTrace();
            System.out.println("Insert not successful");
        }
        try{
            
            java.sql.Statement pss1 = connectDB.createStatement();
            java.sql.ResultSet rss1 = pss1.executeQuery("select bed_no,ward from hp_admission where patient_no = '"+jTextField91.getText()+"' and visit_id = '"+jTextField1.getText()+"' ORDER BY date_admitted DESC LIMIT 1");
            while (rss1.next()){
                jTextField21.setText(rss1.getObject(2).toString());
                jTextField8.setText(rss1.getObject(1).toString());
                //jTextField61.setText(rss1.getObject(3).toString());
            }
            
            
            java.sql.Statement pss11 = connectDB.createStatement();
            java.sql.ResultSet rss11 = pss11.executeQuery("select nr.rate from pb_nssf_rebeats nr");
            while (rss11.next()){
                // jTextField2.setText(rss1.getObject(1).toString());
                Rate = rss11.getFloat(1);
            }
            /*
            java.sql.Statement stmt11 = connectDB.createStatement();
            java.sql.ResultSet rset11 = stmt11.executeQuery("select sum(debit-credit) from hp_patient_card where patient_no ='"+jTextField91.getText()+"'  and visit_id = '"+jTextField1.getText()+"' and paid = 'false'");
            while (rset11.next()){
                // jComboBox6.setSelectedItem(rset.getObject(1).toString());
                jTextField311.setText(rset11.getObject(1).toString());
                //jTextField1.setText(rset.getObject(2).toString());
                //jTextField4.setText(rset.getObject(3).toString());
             
             
            }
             */
        } catch(java.sql.SQLException sqlex){
            javax.swing.JOptionPane.showMessageDialog(this,sqlex.getMessage(),"Error Message!",javax.swing.JOptionPane.ERROR_MESSAGE);
            
            System.out.println(sqlex.getMessage());
        }
        
        float num_c = java.lang.Float.parseFloat(jTextField71.getText());
        float num_d = Rate * num_c;
        
        jTextField31.setText(""+num_d+"");
        jSearchDialog21.dispose();
        
  /*      long date1Long = java.util.Date.parse("12-01-2003");
   
        java.util.Calendar calTest = java.util.Calendar.getInstance();
   
        calTest.setTimeInMillis(date1Long);
   
        java.util.Date date1 = calTest.getTime();
   
        long date2Long = java.util.Date.parse("15-01-2003");
  //      java.util.Calendar calTest = java.util.Calendar.getInstance();
   
        calTest.setTimeInMillis(date2Long);
   
        java.util.Date date2 = calTest.getTime();
   
        int daysDiff = date2.compareTo(date1);
   
        System.out.println("Date 2 minus Date 1 has ["+daysDiff+"] days.");
   */
        // date1.setTime(time
        
        // java.util.Date date2;
        // jTextField61.get
     /*
        try {
            crset21.setCommand("select date::date as date,service,dosage as quantity,debit as amount FROM hp_patient_card WHERE patient_no ='"+jTextField91.getText()+"' and paid = false AND payment_mode = 'Scheme'");// union select date_prescribed as date,description as service,quantity,amount,gl_code from hp_pharmacy WHERE patient_no ='"+jTextField9.getText()+"' and paid = false");
      
            crset21.setConnectionSource(pConnDB);
      
            crset21.execute();
      
            // crset2.setExecuteOnLoad(true);
            jTable11.setModel(new org.netbeans.lib.sql.models.TableModel(crset21, new org.netbeans.lib.sql.models.TableModel.Column[] {
                new org.netbeans.lib.sql.models.TableModel.Column("date", "Date", false),
                new org.netbeans.lib.sql.models.TableModel.Column("service", "Description", false),
                new org.netbeans.lib.sql.models.TableModel.Column("quantity", "Quantity", false),
                new org.netbeans.lib.sql.models.TableModel.Column("amount", "Amount KShs.", false)
              //  new org.netbeans.lib.sql.models.TableModel.Column("gl_code", "Gl Code", false)
      
            }));
      
            //  tableModel = jTable1.getModel();
      
            jScrollPane11.setViewportView(jTable11);
      
        } catch(java.sql.SQLException sqlex){
            javax.swing.JOptionPane.showMessageDialog(this,sqlex.getMessage(),"Error Message!",javax.swing.JOptionPane.ERROR_MESSAGE);
      
            System.out.println(sqlex.getMessage());
        }
      */
        
        
        //  jSearchDialog21.dispose();   // Add your handling code here:
    }//GEN-LAST:event_jSearchTable21MouseClicked
    private void searchButton21Clicked() {
        
        System.out.println("Showing dialog");
        
        // java.awt.Point point = this.jComboBox1311.getLocationOnScreen();
        java.awt.Point point = this.jTextField11.getLocationOnScreen();
        
        jSearchDialog21.setSize(400,200);
        
        jSearchDialog21.setLocation(point);
        
        jSearchDialog21.show();
    }
    
    private void searchButton22Clicked() {
        
        System.out.println("Showing dialog");
        
        // java.awt.Point point = this.jComboBox1311.getLocationOnScreen();
        java.awt.Point point = this.jTextField10.getLocationOnScreen();
        
        jSearchDialog22.setSize(400,200);
        
        jSearchDialog22.setLocation(point);
        
        jSearchDialog22.show();
    }
    private void jTextField1131CaretUpdate(javax.swing.event.CaretEvent evt) {//GEN-FIRST:event_jTextField1131CaretUpdate
        jSearchTable21.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB,"select distinct(patient_no) as pat_no,patient_name as name,visit_id,date_admitted from hp_admission where patient_no ILIKE '"+jTextField1131.getText()+"%' AND discharge = true order by patient_no,date_admitted"));
        
      /*
       
        try {
             searchRowSet21.execute("select distinct(patient_no) as pat_no,patient_name as name,visit_id,date_admitted from hp_admission where patient_no ILIKE '"+jTextField1131.getText()+"%' AND discharge = true order by patient_no,date_admitted");
       
            jSearchTable21.setModel(new org.netbeans.lib.sql.models.TableModel(searchRowSet21, new org.netbeans.lib.sql.models.TableModel.Column[] {
                new org.netbeans.lib.sql.models.TableModel.Column("pat_no", "Patient No", false),
                new org.netbeans.lib.sql.models.TableModel.Column("name", "Name", false),
                new org.netbeans.lib.sql.models.TableModel.Column("visit_id", "Visit ID.", false),
                new org.netbeans.lib.sql.models.TableModel.Column("date_admitted", "Date Admitted", false)
       
            }));
       */
        jSearchScrollPane21.setViewportView(jSearchTable21);
        System.out.println("Cannot sort out");
        
        
        // Add your handling code here:
    }//GEN-LAST:event_jTextField1131CaretUpdate
    private void cmbox2ActionPerformed(java.awt.event.ActionEvent evt){
       /* java.lang.Object selectedGuaran = cmbox2.getSelectedItem();
        int i = jTable1.getSelectedRow();
        
        if (selectedGuaran != null) {
        
            try {
                java.sql.Statement pstmt = connectDB.createStatement();
                java.sql.ResultSet rs = pstmt.executeQuery("select item_code,units from st_stock_item where description = '"+selectedGuaran+"'");
                while (rs.next())
                    jTable1.setValueAt(rs.getObject(1),i,1);
                jTable1.setValueAt(rs.getObject(2),i,2);
            } catch(java.sql.SQLException sqlex){
                System.out.println(sqlex.getMessage());
        
            }
        */
        //}
    }
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton11;
    private javax.swing.JButton jButton31;
    public javax.swing.JButton jButton41;
    private javax.swing.JButton jButton421;
    private javax.swing.JButton jButton422;
    private javax.swing.JButton jButton51;
    private javax.swing.JButton jButton521;
    private javax.swing.JButton jButton522;
    private javax.swing.JCheckBox jCheckBox1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel21;
    private javax.swing.JLabel jLabel31;
    private javax.swing.JLabel jLabel41;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel61;
    private javax.swing.JLabel jLabel611;
    private javax.swing.JLabel jLabel71;
    private javax.swing.JLabel jLabel81;
    private javax.swing.JLabel jLabel91;
    private javax.swing.JPanel jPanel11;
    private javax.swing.JPanel jPanel21;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel41;
    private javax.swing.JPanel jPanel42;
    private javax.swing.JDialog jSearchDialog21;
    private javax.swing.JDialog jSearchDialog22;
    private javax.swing.JPanel jSearchPanel21;
    private javax.swing.JPanel jSearchPanel22;
    private javax.swing.JScrollPane jSearchScrollPane21;
    private javax.swing.JScrollPane jSearchScrollPane22;
    private javax.swing.JTable jSearchTable21;
    private javax.swing.JTable jSearchTable22;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JTextField jTextField1;
    private javax.swing.JTextField jTextField10;
    private javax.swing.JTextField jTextField11;
    private javax.swing.JTextField jTextField1131;
    private javax.swing.JTextField jTextField1132;
    private javax.swing.JTextField jTextField21;
    private javax.swing.JTextField jTextField31;
    private javax.swing.JTextField jTextField311;
    private javax.swing.JTextField jTextField41;
    private javax.swing.JTextField jTextField51;
    private javax.swing.JTextField jTextField61;
    private javax.swing.JTextField jTextField71;
    private javax.swing.JTextField jTextField72;
    private javax.swing.JTextField jTextField8;
    private javax.swing.JTextField jTextField91;
    private javax.swing.JButton searchButton1;
    private javax.swing.JButton searchButton2;
    // End of variables declaration//GEN-END:variables
    
}
