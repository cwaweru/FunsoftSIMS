/*
 * TableView.java
 *
 * Created on March 23, 2004, 9:30 AM
 */

package com.afrisoftech.dbadmin;

/**
 *
 * @author  root
 */
public class GraphicalView extends javax.swing.JInternalFrame implements java.lang.Runnable {
    
    /** Creates new form TableView */
    public boolean pieChart = false;
    
    public boolean xyChart = false;
    
    public boolean barChart = false;
    
    javax.swing.JTable columnSelectorTable = null;
    
    java.lang.String tableName = null;
    
    boolean dateFilterBoolean = false;
    
    java.lang.String customQueryString = null;
    
    javax.swing.JTable exportTable;
    
    java.lang.String chartQueryString;
    
    boolean exportTableBoolean = true;
    
    java.lang.Thread threadExportTable = null;
    
    java.awt.GridBagConstraints gridBagConstraints;
    
    java.sql.Connection connectDB = null;
    
    javax.swing.JTable dataViewTable = null;
    
    java.util.Vector dataViewVector;
    
    java.util.Vector columnVector;
    
    com.afrisoftech.lib.DBObject dbObject;
    
    java.util.Vector childVector;
    
    java.lang.String[] dataViewTableHeader;
    
    org.netbeans.lib.sql.pool.PooledConnectionSource pConnDB = null;
    
    com.afrisoftech.dbadmin.XMLExport xmlExport;
    
    com.afrisoftech.dbadmin.ExcelExport excelExport;
    
    com.afrisoftech.dbadmin.HTMLExport htmlExport;
    
    com.afrisoftech.dbadmin.PDFExport pdfExport;
    
    com.afrisoftech.hospital.HospitalMain hospitalMain = null;
    
    org.jfree.chart.ChartPanel chartPanel = null;
    
    public GraphicalView(java.sql.Connection connDb, org.netbeans.lib.sql.pool.PooledConnectionSource pconnDB) {
        
        dbObject = new com.afrisoftech.lib.DBObject();
        
        connectDB = connDb;
        
        pConnDB = pconnDB;
        
        initComponents();
        
        datesPanel.setVisible(false);
        
/*        datePickerBegin.setVisible(false);
 
        datePickerEnd.setVisible(false);
 */
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        java.awt.GridBagConstraints gridBagConstraints;

        buttonGroupGraphicalView = new javax.swing.ButtonGroup();
        buttonPanel = new javax.swing.JPanel();
        showChart = new javax.swing.JButton();
        chartDimension = new javax.swing.JButton();
        clearChart = new javax.swing.JButton();
        closeForm = new javax.swing.JButton();
        actionsPanel = new javax.swing.JPanel();
        rdchkPanel = new javax.swing.JPanel();
        partialFetchCheckBox = new javax.swing.JCheckBox();
        showXYChartRadio = new javax.swing.JRadioButton();
        showBarChart = new javax.swing.JRadioButton();
        tableActionsPanel = new javax.swing.JPanel();
        printChart = new javax.swing.JButton();
        saveChart = new javax.swing.JButton();
        showData = new javax.swing.JButton();
        export2Excel = new javax.swing.JButton();
        spacerPanel = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        customQuery = new javax.swing.JButton();
        viewPreferences = new javax.swing.JButton();
        tablePanel = new javax.swing.JPanel();
        jScrollPaneDBAdmin = new javax.swing.JScrollPane();
        jPanelTable = new javax.swing.JPanel();
        datesPanel = new javax.swing.JPanel();
        datePickerBegin = new com.afrisoftech.lib.DatePicker();
        datePickerEnd = new com.afrisoftech.lib.DatePicker();
        jLabelBeginDate = new javax.swing.JLabel();
        jLabelEndDate = new javax.swing.JLabel();
        helpPanel = new javax.swing.JPanel();
        jButton1 = new javax.swing.JButton();

        getContentPane().setLayout(new java.awt.GridBagLayout());

        setClosable(true);
        setIconifiable(true);
        setMaximizable(true);
        setResizable(true);
        setTitle("Database Graphical  Analyser");
        setVisible(true);
        buttonPanel.setLayout(new java.awt.GridBagLayout());

        buttonPanel.setBorder(new javax.swing.border.TitledBorder("General Actions"));
        showChart.setMnemonic('r');
        showChart.setText("Show Chart");
        showChart.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                showChartActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 5);
        buttonPanel.add(showChart, gridBagConstraints);

        chartDimension.setMnemonic('u');
        chartDimension.setText("Show3D");
        chartDimension.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                chartDimensionActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 5);
        buttonPanel.add(chartDimension, gridBagConstraints);

        clearChart.setMnemonic('C');
        clearChart.setText("Clear");
        clearChart.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                clearChartActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 5);
        buttonPanel.add(clearChart, gridBagConstraints);

        closeForm.setMnemonic('s');
        closeForm.setText("Close");
        closeForm.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                closeFormActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 5);
        buttonPanel.add(closeForm, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        getContentPane().add(buttonPanel, gridBagConstraints);

        actionsPanel.setLayout(new java.awt.GridBagLayout());

        rdchkPanel.setLayout(new java.awt.GridBagLayout());

        rdchkPanel.setBorder(new javax.swing.border.TitledBorder("Chart Actions"));
        partialFetchCheckBox.setText("Apply date filter");
        partialFetchCheckBox.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                partialFetchCheckBoxActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        rdchkPanel.add(partialFetchCheckBox, gridBagConstraints);

        showXYChartRadio.setText("Display as XY-Line chart");
        buttonGroupGraphicalView.add(showXYChartRadio);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        rdchkPanel.add(showXYChartRadio, gridBagConstraints);

        showBarChart.setText("Show as Bar Chart");
        buttonGroupGraphicalView.add(showBarChart);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        rdchkPanel.add(showBarChart, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        actionsPanel.add(rdchkPanel, gridBagConstraints);

        tableActionsPanel.setLayout(new java.awt.GridBagLayout());

        tableActionsPanel.setBorder(new javax.swing.border.TitledBorder("Export Actions"));
        printChart.setMnemonic('P');
        printChart.setText("Print Chart");
        printChart.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                printChartActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 5, 5);
        tableActionsPanel.add(printChart, gridBagConstraints);

        saveChart.setMnemonic('l');
        saveChart.setText("Save chart as ...");
        saveChart.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                saveChartActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 5, 5);
        tableActionsPanel.add(saveChart, gridBagConstraints);

        showData.setMnemonic('M');
        showData.setText("Show data ...");
        showData.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                showDataActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 5, 5);
        tableActionsPanel.add(showData, gridBagConstraints);

        export2Excel.setMnemonic('D');
        export2Excel.setText("Export to excel ...");
        export2Excel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                export2ExcelActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 5, 5);
        tableActionsPanel.add(export2Excel, gridBagConstraints);

        spacerPanel.setLayout(new java.awt.GridBagLayout());

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        spacerPanel.add(jLabel1, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 50.0;
        tableActionsPanel.add(spacerPanel, gridBagConstraints);

        customQuery.setMnemonic('Q');
        customQuery.setText("Custom Query");
        customQuery.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                customQueryActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(6, 6, 6, 6);
        tableActionsPanel.add(customQuery, gridBagConstraints);

        viewPreferences.setMnemonic('f');
        viewPreferences.setText("Chart View Preferences");
        viewPreferences.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                viewPreferencesActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 5, 5);
        tableActionsPanel.add(viewPreferences, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 3.0;
        actionsPanel.add(tableActionsPanel, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridheight = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        getContentPane().add(actionsPanel, gridBagConstraints);

        tablePanel.setLayout(new java.awt.GridBagLayout());

        tablePanel.setBorder(new javax.swing.border.TitledBorder("Graphical Chart View"));
        jScrollPaneDBAdmin.setHorizontalScrollBarPolicy(javax.swing.JScrollPane.HORIZONTAL_SCROLLBAR_ALWAYS);
        jScrollPaneDBAdmin.setAutoscrolls(true);
        jPanelTable.setLayout(new java.awt.GridBagLayout());

        jScrollPaneDBAdmin.setViewportView(jPanelTable);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        tablePanel.add(jScrollPaneDBAdmin, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 5.0;
        gridBagConstraints.weighty = 100.0;
        getContentPane().add(tablePanel, gridBagConstraints);

        datesPanel.setLayout(new java.awt.GridBagLayout());

        datesPanel.setBorder(new javax.swing.border.TitledBorder("Date Picker"));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 5);
        datesPanel.add(datePickerBegin, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 4, 0, 4);
        datesPanel.add(datePickerEnd, gridBagConstraints);

        jLabelBeginDate.setText("Begin Date");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        datesPanel.add(jLabelBeginDate, gridBagConstraints);

        jLabelEndDate.setText("End Date");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        datesPanel.add(jLabelEndDate, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        getContentPane().add(datesPanel, gridBagConstraints);

        helpPanel.setLayout(new java.awt.GridBagLayout());

        helpPanel.setBorder(new javax.swing.border.TitledBorder("Assistance"));
        jButton1.setMnemonic('H');
        jButton1.setText("Help");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 5, 5);
        helpPanel.add(jButton1, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        getContentPane().add(helpPanel, gridBagConstraints);

        pack();
    }//GEN-END:initComponents

    private void viewPreferencesActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_viewPreferencesActionPerformed

        chartProperties();
        
        // Add your handling code here:
    }//GEN-LAST:event_viewPreferencesActionPerformed
    
    private void partialFetchCheckBoxActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_partialFetchCheckBoxActionPerformed
        
        if (partialFetchCheckBox.isSelected()) {
            
            datesPanel.setVisible(true);
            
        } else {
            
            datesPanel.setVisible(false);
            
        }
        // Add your handling code here:
    }//GEN-LAST:event_partialFetchCheckBoxActionPerformed
    
    private void showChartActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_showChartActionPerformed
        
        showChart(chartQueryString, tableName, hospitalMain);
        
        // Add your handling code here:
    }//GEN-LAST:event_showChartActionPerformed
    
    private void chartDimensionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_chartDimensionActionPerformed
        
        if (chartDimension.getText().matches("Show3D")) {
            
            chartDimension.setText("Show2D");
            
        } else {
            
           chartDimension.setText("Show3D"); 
            
        }
      //  populateTableView(tableName);
        // Add your handling code here:
    }//GEN-LAST:event_chartDimensionActionPerformed
    
    private void clearChartActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_clearChartActionPerformed
        
        dataViewTable = null;
        
        jScrollPaneDBAdmin.setViewportView(dataViewTable);
        
        // Add your handling code here:
    }//GEN-LAST:event_clearChartActionPerformed
    
    private void closeFormActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_closeFormActionPerformed
        
        this.dispose();
        
        // Add your handling code here:
    }//GEN-LAST:event_closeFormActionPerformed
    
    private void customQueryActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_customQueryActionPerformed
        
        com.afrisoftech.dbadmin.GraphicalQueryDialog queryDialog = new com.afrisoftech.dbadmin.GraphicalQueryDialog(new java.awt.Frame(), false, this, hospitalMain);
        
        queryDialog.setVisible(true);
        
        // Add your handling code here:
    }//GEN-LAST:event_customQueryActionPerformed
    
    private void export2ExcelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_export2ExcelActionPerformed
        
        threadExportTable = new java.lang.Thread(this, "Export2PDF");
        
        threadExportTable.start();
        
        // Add your handling code here:
    }//GEN-LAST:event_export2ExcelActionPerformed
    
    private void showDataActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_showDataActionPerformed

        populateCustomQueryTable(chartQueryString);
        
        // Add your handling code here:
    }//GEN-LAST:event_showDataActionPerformed
    
    private void printChartActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_printChartActionPerformed

        printChart();       
        
        // Add your handling code here:
    }//GEN-LAST:event_printChartActionPerformed
    
    private void saveChartActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveChartActionPerformed
        
        saveChart();
        
        // Add your handling code here:
    }//GEN-LAST:event_saveChartActionPerformed
    
    public void populateTableView(java.lang.String selectedTable) {
        
        this.invalidate();
        
        createTableVectors(selectedTable);
        
        dataViewTable = new javax.swing.JTable(dataViewVector, columnVector) {
            
            
            
        };
        
        int columnCount = columnVector.capacity();
        
        for (int i = 0; i < columnCount; i++) {
            
            dataViewTable.getColumnModel().getColumn(i).setWidth(200);
            
        }
        
        gridBagConstraints = new java.awt.GridBagConstraints();
        
        gridBagConstraints.gridx = 0;
        
        gridBagConstraints.gridy = 1;
        
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        
        gridBagConstraints.weightx = 1.0;
        
        gridBagConstraints.weighty = 100.0;
        
        jPanelTable.removeAll();
        
        jPanelTable.add(dataViewTable, gridBagConstraints);
        
        gridBagConstraints = new java.awt.GridBagConstraints();
        
        gridBagConstraints.gridx = 0;
        
        gridBagConstraints.gridy = 0;
        
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        
        gridBagConstraints.weightx = 1.0;
        
        gridBagConstraints.weighty = 1.0;
        
        dataViewTable.getTableHeader().setBackground(java.awt.Color.GREEN);
        
        dataViewTable.getTableHeader().setForeground(java.awt.Color.BLUE);
        
        //        jScrollPaneDBAdmin.setRowHeaderView(jPanelTable);
        
        //        dataViewTable.getTableHeader().setOpaque(true);
        
        jPanelTable.add(dataViewTable.getTableHeader(), gridBagConstraints);
        
        jScrollPaneDBAdmin.setViewportView(jPanelTable);
        
        tablePanel.setBorder(new javax.swing.border.TitledBorder("Table View for table ["+tableName.toUpperCase()+"]"));
        
        //        jScrollPaneDBAdmin.setSize(5000,1000);
        
        //        jScrollPaneDBAdmin.setViewportView(dataViewTable);
        
        //        this.invalidate();
        
        exportTable = dataViewTable;
        
        this.validate();
        
        
    }
    
    public void createTableVectors(java.lang.String selectedTable) {
        
        dateFilterBoolean = false;
        
        tableName = selectedTable.toUpperCase();
        
        dataViewVector = new java.util.Vector(1,1);
        
        int rowCount = 0;
        
        try {
/*
            java.sql.PreparedStatement pstmtcountVector = connectDB.prepareStatement("SELECT COUNT(*) FROM "+selectedTable);
 
            java.sql.ResultSet rsetCountVector = pstmtcountVector.executeQuery();
 
            while(rsetCountVector.next()) {
 
                rowCount = rsetCountVector.getInt(1);
 
            }
 */
            customQueryString = "select * from "+selectedTable;
            
            java.sql.PreparedStatement pstmtVector = connectDB.prepareStatement(customQueryString);
            
            java.sql.ResultSet rsetVector = pstmtVector.executeQuery();
            
            java.sql.ResultSetMetaData rsetMetaData = rsetVector.getMetaData();
            
            pstmtVector.setCursorName("myCursor");
            
            String cursorName = rsetVector.getCursorName();
            
            System.out.println("Cursor name = ["+cursorName+"]");
            
            int columnCount = rsetMetaData.getColumnCount();
            
            //            System.out.println("Column count : ["+columnCount+"]");
            
            //            childVector = new java.util.Vector(columnCount);
            
            //            System.out.println("Done childVector");
            
            columnVector = new java.util.Vector(columnCount);
            
            //            System.out.println("Done columnVector");
            
            for (int i = 0; i < columnCount; i++) {
                //                System.out.println("Done with Headers"+rsetMetaData.getColumnName(i + 1).toUpperCase());
                columnVector.add(i,rsetMetaData.getColumnName(i + 1).toUpperCase());
                
                if (rsetMetaData.getColumnName(i + 1).matches("date") || rsetMetaData.getColumnName(i + 1).endsWith("date") || rsetMetaData.getColumnName(i + 1).startsWith("date")) {
                    
                    dateFilterBoolean = true;
                    
                    datesPanel.setVisible(true);
                    
                } else {
                    
                    if (!dateFilterBoolean) {
                        
                        datesPanel.setVisible(false);
                        
                    }
                }
                
                //                System.out.println("Done with Headers"+rsetMetaData.getColumnName(i + 1).toUpperCase());
                
            }
            
            //            int i = 0;
            
            while (rsetVector.next()) {
                childVector = new java.util.Vector(columnCount);
                //                childVector.removeAllElements();
                
                for (int j = 0; j < columnCount; j++) {
                    
                    childVector.addElement(dbObject.getDBObject(rsetVector.getString(j + 1), "-"));
                    
                }
                
                dataViewVector.add(childVector);
                
            }
            
        } catch(java.sql.SQLException sqlExec) {
            
            javax.swing.JOptionPane.showMessageDialog(new java.awt.Frame(), sqlExec.getMessage());
            
        }
        
    }
    
    public javax.swing.JTable getExportTable() {
        
        javax.swing.JTable table2Export = null;
        
        if (exportTable != null) {
            
            table2Export = exportTable;
            
        }
        
        return table2Export;
        
    }
    
    public void run() {
        
        if (exportTableBoolean == false) {
            
            exportTableBoolean = true;
            
        }
        
        while (exportTableBoolean) {
            
            System.out.println("Export process started for thread ["+Thread.currentThread().getName()+"]");
            
            if (Thread.currentThread().getName().matches("Export2Excel")) {
                
                System.out.println("Exporting Export2Excel");
                
                excelExport = new com.afrisoftech.dbadmin.ExcelExport(this.getExportTable(), tableName);
                
            } else if (Thread.currentThread().getName().matches("Export2Xml")) {
                
                xmlExport = new com.afrisoftech.dbadmin.XMLExport(this.getExportTable(), tableName);
                
            } else if (Thread.currentThread().getName().matches("Export2HTML")) {
                
                htmlExport = new com.afrisoftech.dbadmin.HTMLExport(this.getExportTable(), tableName);
                
            } else if (Thread.currentThread().getName().matches("Export2PDF")) {
                
                pdfExport = new com.afrisoftech.dbadmin.PDFExport(this.getExportTable(), tableName);
                
            }
            
            
            try {
                
                Thread.currentThread().sleep(100);
                
            } catch(java.lang.InterruptedException IntExec){ System.out.println(IntExec.getMessage());}
            
            exportTableBoolean = false;
            
        }
        
        
    }
    
    protected void setQueryString(java.lang.String queryString) {
        
        customQueryString = queryString;
        
        chartQueryString = queryString;
        
    }
    
    protected void populateCustomQueryTable(java.lang.String chartQuery) {
        
        this.invalidate();
        
        createCustomTableVectors(chartQuery);//tableName);
        
        dataViewTable = new javax.swing.JTable(dataViewVector, columnVector);
        
        int columnCount = columnVector.capacity();
        
        for (int i = 0; i < columnCount; i++) {
            
            dataViewTable.getColumnModel().getColumn(i).setWidth(200);
            
        }
        
        gridBagConstraints = new java.awt.GridBagConstraints();
        
        gridBagConstraints.gridx = 0;
        
        gridBagConstraints.gridy = 1;
        
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        
        gridBagConstraints.weightx = 1.0;
        
        gridBagConstraints.weighty = 100.0;
        
        jPanelTable.removeAll();
        
        jPanelTable.add(dataViewTable, gridBagConstraints);
        
        gridBagConstraints = new java.awt.GridBagConstraints();
        
        gridBagConstraints.gridx = 0;
        
        gridBagConstraints.gridy = 0;
        
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        
        gridBagConstraints.weightx = 1.0;
        
        gridBagConstraints.weighty = 1.0;
        
        dataViewTable.getTableHeader().setBackground(java.awt.Color.GREEN);
        
        dataViewTable.getTableHeader().setForeground(java.awt.Color.BLUE);
        
        //        jScrollPaneDBAdmin.setRowHeaderView(jPanelTable);
        
        //        dataViewTable.getTableHeader().setOpaque(true);
        
        jPanelTable.add(dataViewTable.getTableHeader(), gridBagConstraints);
        
        jScrollPaneDBAdmin.setViewportView(jPanelTable);
        
        tablePanel.setBorder(new javax.swing.border.TitledBorder("Table View for ["+tableName.toUpperCase()+"]"));
        
        
        
        //        jScrollPaneDBAdmin.setSize(5000,1000);
        
        //        jScrollPaneDBAdmin.setViewportView(dataViewTable);
        
        //        this.invalidate();
        
        exportTable = dataViewTable;
        
        this.validate();
        
        
        
    }
    
    protected void createCustomTableVectors(java.lang.String queryString) {
        
        dateFilterBoolean = false;
        
        boolean pastFrom = false;
        //        tableName = selectedTable.toUpperCase();
        
        dataViewVector = new java.util.Vector(1,1);
        
        int rowCount = 0;
        
        try {
/*
            java.sql.PreparedStatement pstmtcountVector = connectDB.prepareStatement("SELECT COUNT(*) FROM "+selectedTable);
 
            java.sql.ResultSet rsetCountVector = pstmtcountVector.executeQuery();
 
            while(rsetCountVector.next()) {
 
                rowCount = rsetCountVector.getInt(1);
 
            }
 */
            java.util.StringTokenizer sqlTokenizer = new java.util.StringTokenizer(chartQueryString);
            
            while (sqlTokenizer.hasMoreTokens()) {
                
                if (pastFrom) {
                    
                    tableName = sqlTokenizer.nextToken();
                    
                    pastFrom = false;
                    
                }
                
                if (sqlTokenizer.nextToken() == "from") {
                    
                    pastFrom = true;
                    
                }
                
            }
            
/*            int tableFrom = customQueryString.indexOf("from");
 
            tableName = customQueryString.substring(tableFrom + 5);
 */
            java.sql.PreparedStatement pstmtVector = connectDB.prepareStatement(chartQueryString);
            
            java.sql.ResultSet rsetVector = pstmtVector.executeQuery();
            
            java.sql.ResultSetMetaData rsetMetaData = rsetVector.getMetaData();
            
            //    tableName = rsetMetaData.getTableName(1);
            
            int columnCount = rsetMetaData.getColumnCount();
            
            //            System.out.println("Column count : ["+columnCount+"]");
            
            //            childVector = new java.util.Vector(columnCount);
            
            //            System.out.println("Done childVector");
            
            columnVector = new java.util.Vector(columnCount);
            
            //            System.out.println("Done columnVector");
            
            for (int i = 0; i < columnCount; i++) {
                //                System.out.println("Done with Headers"+rsetMetaData.getColumnName(i + 1).toUpperCase());
                columnVector.add(i,rsetMetaData.getColumnName(i + 1).toUpperCase());
                
                if (rsetMetaData.getColumnName(i + 1).matches("date") || rsetMetaData.getColumnName(i + 1).endsWith("date") || rsetMetaData.getColumnName(i + 1).startsWith("date")) {
                    
                    dateFilterBoolean = true;
                    
                    datesPanel.setVisible(true);
                    
                } else {
                    
                    if (!dateFilterBoolean) {
                        
                        datesPanel.setVisible(false);
                        
                    }
                    
                }
                
                //                System.out.println("Done with Headers"+rsetMetaData.getColumnName(i + 1).toUpperCase());
                
            }
            
            //            int i = 0;
            
            while (rsetVector.next()) {
                childVector = new java.util.Vector(columnCount);
                //                childVector.removeAllElements();
                
                for (int j = 0; j < columnCount; j++) {
                    
                    childVector.addElement(dbObject.getDBObject(rsetVector.getString(j + 1), "-"));
                    
                }
                
                dataViewVector.add(childVector);
                
            }
            
        } catch(java.sql.SQLException sqlExec) {
            
            javax.swing.JOptionPane.showMessageDialog(new java.awt.Frame(), sqlExec.getMessage());
            
        }
        
    }
    
    protected java.lang.String createDateFilter() {
        
        java.lang.String dateFilter = " ";
        
        if ((datePickerBegin.getDate().equals(null)) && (datePickerEnd.getDate().equals(null))) {
            
            dateFilter = dateFilter + "where date between '"+datePickerBegin.getDate().toString()+"' and '"+datePickerEnd.getDate().toString()+"'";
            
        } else if (datePickerEnd.getDate().equals(null)) {
            
            dateFilter = dateFilter + "where date > '"+datePickerBegin.getDate().toString()+"'";
            
        } else if (datePickerEnd.getDate().equals(null)){
            
            dateFilter = dateFilter + "where date < '"+datePickerEnd.getDate().toString()+"'";
            
        }
        
        return dateFilter;
        
    }
/*
    protected class TableViewModel extends javax.swing.table.DefaultTableModel {
 
        java.util.Vector tableDataVector = dataViewVector;
 
        java.util.Vector tableColumnVector = columnVector;
 
        public int getRowCount() {
 
            return tableDataVector.toArray().length;
 
        }
 
        public int getColumnCount() {
 
            return tableColumnVector.toArray().length;
 
        }
 
        public java.lang.Object getValueAt(int row, int column) {
 
            return
 
        }
 
    }
 */
    private org.jfree.data.JDBCCategoryDataset getJDBCXYDataset() {
        
        org.jfree.data.JDBCCategoryDataset jdbcXYDataset = null;
        
        try {
            
            jdbcXYDataset =  new org.jfree.data.JDBCCategoryDataset(connectDB, chartQueryString);//"SELECT * FROM "+tableName);
            
        } catch (java.sql.SQLException sqlExec) {
            
            sqlExec.printStackTrace();
            
            javax.swing.JOptionPane.showMessageDialog(new java.awt.Frame(), sqlExec.getMessage());
            
        }
        
        return jdbcXYDataset;
    }
    private org.jfree.data.JDBCXYDataset getJDBCXYZDataset() {
        
        org.jfree.data.JDBCXYDataset jdbcXYDataset = null;
        
        try {
            
            jdbcXYDataset =  new org.jfree.data.JDBCXYDataset(connectDB, chartQueryString);//"SELECT * FROM "+tableName);
            
        } catch (java.sql.SQLException sqlExec) {
            
            sqlExec.printStackTrace();
            
            javax.swing.JOptionPane.showMessageDialog(new java.awt.Frame(), sqlExec.getMessage());
            
        }
        
        return jdbcXYDataset;
    }
    
    private org.jfree.data.JDBCPieDataset getJDBCPIEDataset() {
        
        org.jfree.data.JDBCPieDataset jdbcPIEDataset = null;
        
        try {
            
            jdbcPIEDataset =  new org.jfree.data.JDBCPieDataset(connectDB, chartQueryString);//"SELECT * FROM "+tableName);
            
        } catch (java.sql.SQLException sqlExec) {
            
            sqlExec.printStackTrace();
            
            javax.swing.JOptionPane.showMessageDialog(new java.awt.Frame(), sqlExec.getMessage());
            
        }
        
        return jdbcPIEDataset;
    }    
    
    private org.jfree.chart.ChartPanel getChartPanel() {
        
       chartPanel = new org.jfree.chart.ChartPanel(getJFreeChart(), true, true, true, true, true);
        //        org.jfree.chart.ChartPanel chartPanel = new org.jfree.chart.ChartPanel(getJFreeChart());
        return chartPanel;
    }
    
    private org.jfree.chart.JFreeChart getJFreeChart() {
        
        org.jfree.chart.JFreeChart jfreeChart = null;
        
        if (barChart) {
        
        jfreeChart = org.jfree.chart.ChartFactory.createBarChart3D("Chart for Table ["+tableName.toUpperCase()+"]", "X-Axis", "Y-Axis", getJDBCXYDataset(), org.jfree.chart.plot.PlotOrientation.VERTICAL, true, true, true);
        
        } else if (pieChart) {
         
            jfreeChart = org.jfree.chart.ChartFactory.createPie3DChart("Chart for Table ["+tableName.toUpperCase()+"]", getJDBCPIEDataset(), true, true, true);
            
            org.jfree.chart.plot.Pie3DPlot piePlot = (org.jfree.chart.plot.Pie3DPlot)jfreeChart.getPlot();
            
            piePlot.setSectionLabelType(org.jfree.chart.plot.Pie3DPlot.NAME_AND_PERCENT_LABELS);
            
            piePlot.setExplodePercent(1, 1.00);
            
        } else {
            
            jfreeChart = org.jfree.chart.ChartFactory.createLineChart("Chart for Table ["+tableName.toUpperCase()+"]", "X-Axis", "Y-Axis", getJDBCXYDataset(), org.jfree.chart.plot.PlotOrientation.VERTICAL, true, true, true);
        }
        return jfreeChart;
    }

     
    private org.jfree.chart.JFreeChart getPIEJFreeChart() {
        
        org.jfree.chart.JFreeChart jfreeChart = null;
        
        jfreeChart = org.jfree.chart.ChartFactory.createPieChart3D("Chart for Table ["+tableName.toUpperCase()+"]", getJDBCPIEDataset(), true, true, true);
        
        return jfreeChart;
    }
    
    
    private org.jfree.chart.JFreeChart getXYJFreeChart() {
        
        org.jfree.chart.JFreeChart jfreeChart = null;
        
        jfreeChart = org.jfree.chart.ChartFactory.createLineXYChart("Chart for Table ["+tableName.toUpperCase()+"]", "X-Axis", "Y-Axis", getJDBCXYZDataset(), org.jfree.chart.plot.PlotOrientation.VERTICAL, true, true, true);
        
        return jfreeChart;
    }    
    
    public void showChart(java.lang.String chartqueryString, java.lang.String selectedTableName, com.afrisoftech.hospital.HospitalMain hospitalmain) {
        
        hospitalMain = hospitalmain;
        
        chartQueryString = chartqueryString;
        
        tableName = selectedTableName;
        
        this.invalidate();
        
/*        createCustomTableVectors(null);//tableName);
 
        dataViewTable = new javax.swing.JTable(dataViewVector, columnVector);
 
        int columnCount = columnVector.capacity();
 
        for (int i = 0; i < columnCount; i++) {
 
            dataViewTable.getColumnModel().getColumn(i).setWidth(200);
 
        }
 */
        gridBagConstraints = new java.awt.GridBagConstraints();
        
        gridBagConstraints.gridx = 0;
        
        gridBagConstraints.gridy = 1;
        
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        
        gridBagConstraints.weightx = 1.0;
        
        gridBagConstraints.weighty = 100.0;
        
        jPanelTable.removeAll();
        
        jPanelTable.add(getChartPanel(), gridBagConstraints);
        
        gridBagConstraints = new java.awt.GridBagConstraints();
        
        gridBagConstraints.gridx = 0;
        
        gridBagConstraints.gridy = 0;
        
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        
        gridBagConstraints.weightx = 1.0;
        
        gridBagConstraints.weighty = 1.0;
        
        //        dataViewTable.getTableHeader().setBackground(java.awt.Color.GREEN);
        
        //        dataViewTable.getTableHeader().setForeground(java.awt.Color.BLUE);
        
        //        jScrollPaneDBAdmin.setRowHeaderView(jPanelTable);
        
        //        dataViewTable.getTableHeader().setOpaque(true);
        
        //        jPanelTable.add(dataViewTable.getTableHeader(), gridBagConstraints);
        
        jScrollPaneDBAdmin.setViewportView(jPanelTable);
        
        tablePanel.setBorder(new javax.swing.border.TitledBorder("Graphical View for ["+tableName.toUpperCase()+"]"));
        
        
        
        //        jScrollPaneDBAdmin.setSize(5000,1000);
        
        //        jScrollPaneDBAdmin.setViewportView(dataViewTable);
        
        //        this.invalidate();
        
        exportTable = dataViewTable;
        
        this.validate();
        
        
    }
    
    public void printChart() {

        javax.swing.MenuElement[] chartMenuElements =  chartPanel.getPopupMenu().getSubElements();
     
        for (int i = 0; i < chartMenuElements.length; i++) {
        
            javax.swing.JMenuItem menuItem = (javax.swing.JMenuItem)chartMenuElements[i];
            
            if (menuItem.getText().startsWith("Print")) {
                
               menuItem.doClick(); 
                
            }
            
            
        }
        
    }
    
    public void saveChart() {

        javax.swing.MenuElement[] chartMenuElements =  chartPanel.getPopupMenu().getSubElements();
     
        for (int i = 0; i < chartMenuElements.length; i++) {
        
            javax.swing.JMenuItem menuItem = (javax.swing.JMenuItem)chartMenuElements[i];
            
            if (menuItem.getText().startsWith("Save")) {
                
               menuItem.doClick(); 
                
            }
            
            
        }
        
    } 
    
    public void chartProperties() {

        javax.swing.MenuElement[] chartMenuElements =  chartPanel.getPopupMenu().getSubElements();
     
        for (int i = 0; i < chartMenuElements.length; i++) {
        
            javax.swing.JMenuItem menuItem = (javax.swing.JMenuItem)chartMenuElements[i];
            
            if (menuItem.getText().startsWith("Properties")) {
                
               menuItem.doClick(); 
                
            }
            
            
        }
        
    } 
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JScrollPane jScrollPaneDBAdmin;
    private javax.swing.ButtonGroup buttonGroupGraphicalView;
    private javax.swing.JCheckBox partialFetchCheckBox;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JButton clearChart;
    private javax.swing.JPanel tablePanel;
    private javax.swing.JPanel actionsPanel;
    private javax.swing.JButton jButton1;
    private javax.swing.JPanel spacerPanel;
    private javax.swing.JButton export2Excel;
    private javax.swing.JButton chartDimension;
    private javax.swing.JLabel jLabelEndDate;
    private javax.swing.JButton viewPreferences;
    private javax.swing.JButton printChart;
    private javax.swing.JRadioButton showBarChart;
    private com.afrisoftech.lib.DatePicker datePickerEnd;
    private javax.swing.JPanel jPanelTable;
    private javax.swing.JPanel helpPanel;
    private com.afrisoftech.lib.DatePicker datePickerBegin;
    private javax.swing.JRadioButton showXYChartRadio;
    private javax.swing.JPanel rdchkPanel;
    private javax.swing.JPanel buttonPanel;
    private javax.swing.JButton showData;
    private javax.swing.JPanel tableActionsPanel;
    private javax.swing.JLabel jLabelBeginDate;
    private javax.swing.JButton showChart;
    private javax.swing.JPanel datesPanel;
    private javax.swing.JButton customQuery;
    private javax.swing.JButton saveChart;
    private javax.swing.JButton closeForm;
    // End of variables declaration//GEN-END:variables
    
}
